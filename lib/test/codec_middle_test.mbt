// Code generated by scripts/gen_codec_tests.py. DO NOT EDIT.

///|
struct MiddleDecoded {
  id : Int
  values : Array[Int]
  packed_values : Array[Int]
  label : String
  data : Bytes
  nested : (Int64, Bool, String)?
  status : UInt
  tags : Array[String]
}

///|
struct MiddleCase {
  b64 : String
  id : Int
  values : Array[Int]
  packed_values : Array[Int]
  label : String
  data : Bytes
  nested : (Int64, Bool, String)?
  status : UInt
  tags : Array[String]
}

///|
fn decode_middle_nested(bytes : Bytes) -> (Int64, Bool, String) raise {
  let reader = @protobuf.BytesReader::from_bytes(bytes) as &@protobuf.Reader
  let mut count = 0L
  let mut flag = false
  let mut note = ""
  while true {
    let tag_result = try reader |> @protobuf.read_tag() catch {
      _ => None
    } noraise {
      v => Some(v)
    }
    match tag_result {
      Some((tag, wire_type)) =>
        match tag {
          1 => count = reader |> @protobuf.read_int64()
          2 => flag = reader |> @protobuf.read_bool()
          3 => note = reader |> @protobuf.read_string()
          _ => reader |> @protobuf.read_unknown(wire_type)
        }
      None => break
    }
  }
  (count, flag, note)
}

///|
fn decode_middle(b64 : String) -> MiddleDecoded raise {
  let bytes = @protobuf.base64_decode(b64)
  let reader = @protobuf.BytesReader::from_bytes(bytes) as &@protobuf.Reader
  let mut id = 0
  let values : Array[Int] = []
  let packed_values : Array[Int] = []
  let mut label = ""
  let mut data = b""
  let mut nested : (Int64, Bool, String)? = None
  let mut status = 0U
  let tags : Array[String] = []
  while true {
    let tag_result = try reader |> @protobuf.read_tag() catch {
      _ => None
    } noraise {
      v => Some(v)
    }
    match tag_result {
      Some((tag, wire_type)) =>
        match tag {
          1 => id = reader |> @protobuf.read_int32()
          2 => values.push(reader |> @protobuf.read_int32())
          3 => {
            let packed = reader
              |> @protobuf.read_packed(
                fn(r) { r |> @protobuf.read_sint32() },
                None,
              )
            for value in packed {
              packed_values.push(value.0)
            }
          }
          4 => label = reader |> @protobuf.read_string()
          5 => data = reader |> @protobuf.read_bytes()
          6 =>
            nested = reader
              |> @protobuf.read_bytes()
              |> decode_middle_nested()
              |> Some
          7 => status = (reader |> @protobuf.read_enum()).0
          8 => tags.push(reader |> @protobuf.read_string())
          _ => reader |> @protobuf.read_unknown(wire_type)
        }
      None => break
    }
  }
  { id, values, packed_values, label, data, nested, status, tags }
}

///|
fn encode_middle_nested(value : (Int64, Bool, String)) -> Bytes raise {
  let (count, flag, note) = value
  let writer = @buffer.new()
  if count != 0L {
    writer |> @protobuf.write_tag((1U, 0U))
    writer |> @protobuf.write_int64(count)
  }
  if flag {
    writer |> @protobuf.write_tag((2U, 0U))
    writer |> @protobuf.write_bool(flag)
  }
  if note != "" {
    writer |> @protobuf.write_tag((3U, 2U))
    writer |> @protobuf.write_string(note)
  }
  writer.to_bytes()
}

///|
fn encode_middle(case : MiddleCase) -> String raise {
  let writer = @buffer.new()
  if case.id != 0 {
    writer |> @protobuf.write_tag((1U, 0U))
    writer |> @protobuf.write_int32(case.id)
  }
  for value in case.values {
    writer |> @protobuf.write_tag((2U, 0U))
    writer |> @protobuf.write_int32(value)
  }
  if case.packed_values.length() > 0 {
    let packed_writer = @buffer.new()
    for value in case.packed_values {
      packed_writer |> @protobuf.write_sint32(value)
    }
    writer |> @protobuf.write_tag((3U, 2U))
    writer |> @protobuf.write_bytes(packed_writer.to_bytes())
  }
  if case.label != "" {
    writer |> @protobuf.write_tag((4U, 2U))
    writer |> @protobuf.write_string(case.label)
  }
  if case.data.length() > 0 {
    writer |> @protobuf.write_tag((5U, 2U))
    writer |> @protobuf.write_bytes(case.data)
  }
  if case.nested is Some(value) {
    writer |> @protobuf.write_tag((6U, 2U))
    writer |> @protobuf.write_bytes(encode_middle_nested(value))
  }
  if case.status != 0U {
    writer |> @protobuf.write_tag((7U, 0U))
    writer |> @protobuf.write_enum(@protobuf.Enum(case.status))
  }
  for tag in case.tags {
    writer |> @protobuf.write_tag((8U, 2U))
    writer |> @protobuf.write_string(tag)
  }
  writer.to_bytes() |> @protobuf.base64_encode
}

///|
test "middle/messages" {
  let cases : Array[MiddleCase] = [
    {
      b64: "",
      id: 0,
      values: [],
      packed_values: [],
      label: "",
      data: b"",
      nested: None,
      status: 0U,
      tags: [],
    },
    {
      b64: "CAEQARoBACIMbmVzdGVkLWVtcHR5KgEAMgA4AUIBYQ==",
      id: 1,
      values: [1],
      packed_values: [0],
      label: "nested-empty",
      data: b"\x00",
      nested: Some((0L, false, "")),
      status: 1U,
      tags: ["a"],
    },
    {
      b64: "CP///////////wEQ////////////ARD+//////////8BGgEBIgNuZWcqAf8yEgj///////////8BEAEaA25lZzgCQgNuZWc=",
      id: -1,
      values: [-1, -2],
      packed_values: [-1],
      label: "neg",
      data: b"\xff",
      nested: Some((-1L, true, "neg")),
      status: 2U,
      tags: ["neg"],
    },
    {
      b64: "CP////8HEP////8HGgr/////D/7///8PIgNtYXgqAgD/MhEI//////////9/EAEaA21heDgBQgRlZGdl",
      id: 2147483647,
      values: [2147483647],
      packed_values: [-2147483648, 2147483647],
      label: "max",
      data: b"\x00\xff",
      nested: Some((9223372036854775807L, true, "max")),
      status: 1U,
      tags: ["edge"],
    },
    {
      b64: "CICAgID4/////wEQgICAgPj/////ARoCAAIiA21pbioDECAwMhAIgICAgICAgICAARoDbWluOAJCBGVkZ2VCA21pbg==",
      id: -2147483648,
      values: [-2147483648],
      packed_values: [0, 1],
      label: "min",
      data: b"\x10\x20\x30",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 2U,
      tags: ["edge", "min"],
    },
    {
      b64: "CCoaA4CJDyIJdGFncy1vbmx5OAFCAnQxQgJ0MkICdDM=",
      id: 42,
      values: [],
      packed_values: [123456],
      label: "tags-only",
      data: b"",
      nested: None,
      status: 1U,
      tags: ["t1", "t2", "t3"],
    },
    {
      b64: "",
      id: 0,
      values: [],
      packed_values: [],
      label: "",
      data: b"",
      nested: None,
      status: 0U,
      tags: [],
    },
    {
      b64: "CAEQ////////////ARD+//////////8BGgOAiQ8iC3BhdGhcXHNsYXNoKgIBAjIQCICAgICAgICAgAEaA21pbkIEZWRnZQ==",
      id: 1,
      values: [-1, -2],
      packed_values: [123456],
      label: "path\\\\slash",
      data: b"\x01\x02",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 0U,
      tags: ["edge"],
    },
    {
      b64: "CP///////////wEQgPj/////////ARCACBoBACILc3ltYm9scy0hQCMqBAD/ECAyEQj//////////38QARoDbWF4OAFCB3RhZy1vbmVCB3RhZy10d29CCXRhZy10aHJlZQ==",
      id: -1,
      values: [-1024, 1024],
      packed_values: [0],
      label: "symbols-!@#",
      data: b"\x00\xff\x10\x20",
      nested: Some((9223372036854775807L, true, "max")),
      status: 1U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "CAIQ6AcQmPj/////////ARoD/4gPIgp3aXRoIHNwYWNlKhAAAQIDBAUGBwgJCgsMDQ4PMgsIlZrvOhoEbm90ZTgCQgFh",
      id: 2,
      values: [1000, -1000],
      packed_values: [-123456],
      label: "with space",
      data: b"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f",
      nested: Some((123456789L, false, "note")),
      status: 2U,
      tags: ["a"],
    },
    {
      b64: "CP7//////////wEQABoCAgEiBWRlbHRhKgirq6urq6urqzISCP///////////wEQARoDbmVnQgJtMUICbTJCAm0zQgJtNA==",
      id: -2,
      values: [0],
      packed_values: [1, -1],
      label: "delta",
      data: b"\xab\xab\xab\xab\xab\xab\xab\xab",
      nested: Some((-1L, true, "neg")),
      status: 0U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "CH8QfxCAARCBARoK/////w/+////DyIFZ2FtbWEqAQAyBwgBEAEaAW5CA2R1cEIDZHVw",
      id: 127,
      values: [127, 128, 129],
      packed_values: [-2147483648, 2147483647],
      label: "gamma",
      data: b"\x00",
      nested: Some((1L, true, "n")),
      status: 0U,
      tags: ["dup", "dup"],
    },
    {
      b64: "CIABEP////8HGgV+fYABfyIEYmV0YSoB/zIAOAFCAXhCAXk=",
      id: 128,
      values: [2147483647],
      packed_values: [63, -63, 64, -64],
      label: "beta",
      data: b"\xff",
      nested: Some((0L, false, "")),
      status: 1U,
      tags: ["x", "y"],
    },
    {
      b64: "CIAIEAAQABAAGgQKDA4QIgVhbHBoYSoFAAECAwQ4Ag==",
      id: 1024,
      values: [0, 0, 0],
      packed_values: [5, 6, 7, 8],
      label: "alpha",
      data: b"\x00\x01\x02\x03\x04",
      nested: None,
      status: 2U,
      tags: [],
    },
    {
      b64: "CID4/////////wEQARACEAMaCf5//X+AgAH/fyoE3q2+7zIQCICAgICAgICAgAEaA21pbkIEZWRnZQ==",
      id: -1024,
      values: [1, 2, 3],
      packed_values: [8191, -8191, 8192, -8192],
      label: "",
      data: b"\xde\xad\xbe\xef",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 0U,
      tags: ["edge"],
    },
    {
      b64: "CICAARCACBCAECILcGF0aFxcc2xhc2gyEQj//////////38QARoDbWF4Qgd0YWctb25lQgd0YWctdHdvQgl0YWctdGhyZWU=",
      id: 16384,
      values: [1024, 2048],
      packed_values: [],
      label: "path\\\\slash",
      data: b"",
      nested: Some((9223372036854775807L, true, "max")),
      status: 0U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "CICA/////////wEQgICAgPj/////ARoDgIkPIgtzeW1ib2xzLSFAIyoCAQIyCwiVmu86GgRub3RlOAFCAWE=",
      id: -16384,
      values: [-2147483648],
      packed_values: [123456],
      label: "symbols-!@#",
      data: b"\x01\x02",
      nested: Some((123456789L, false, "note")),
      status: 1U,
      tags: ["a"],
    },
    {
      b64: "CP////8HGgEAIgp3aXRoIHNwYWNlKgQA/xAgMhII////////////ARABGgNuZWc4AkICbTFCAm0yQgJtM0ICbTQ=",
      id: 2147483647,
      values: [],
      packed_values: [0],
      label: "with space",
      data: b"\x00\xff\x10\x20",
      nested: Some((-1L, true, "neg")),
      status: 2U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "CICAgID4/////wEQ////////////ARD+//////////8BGgP/iA8iBWRlbHRhKhAAAQIDBAUGBwgJCgsMDQ4PMgcIARABGgFuQgNkdXBCA2R1cA==",
      id: -2147483648,
      values: [-1, -2],
      packed_values: [-123456],
      label: "delta",
      data: b"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f",
      nested: Some((1L, true, "n")),
      status: 0U,
      tags: ["dup", "dup"],
    },
    {
      b64: "EID4/////////wEQgAgaAgIBIgVnYW1tYSoIq6urq6urq6syAEIBeEIBeQ==",
      id: 0,
      values: [-1024, 1024],
      packed_values: [1, -1],
      label: "gamma",
      data: b"\xab\xab\xab\xab\xab\xab\xab\xab",
      nested: Some((0L, false, "")),
      status: 0U,
      tags: ["x", "y"],
    },
    {
      b64: "CAEQ6AcQmPj/////////ARoK/////w/+////DyIEYmV0YSoBADgB",
      id: 1,
      values: [1000, -1000],
      packed_values: [-2147483648, 2147483647],
      label: "beta",
      data: b"\x00",
      nested: None,
      status: 1U,
      tags: [],
    },
    {
      b64: "CP///////////wEQABoFfn2AAX8iBWFscGhhKgH/MhAIgICAgICAgICAARoDbWluOAJCBGVkZ2U=",
      id: -1,
      values: [0],
      packed_values: [63, -63, 64, -64],
      label: "alpha",
      data: b"\xff",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 2U,
      tags: ["edge"],
    },
    {
      b64: "CAIQfxCAARCBARoECgwOECoFAAECAwQyEQj//////////38QARoDbWF4Qgd0YWctb25lQgd0YWctdHdvQgl0YWctdGhyZWU=",
      id: 2,
      values: [127, 128, 129],
      packed_values: [5, 6, 7, 8],
      label: "",
      data: b"\x00\x01\x02\x03\x04",
      nested: Some((9223372036854775807L, true, "max")),
      status: 0U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "CP7//////////wEQ/////wcaCf5//X+AgAH/fyILcGF0aFxcc2xhc2gqBN6tvu8yCwiVmu86GgRub3RlQgFh",
      id: -2,
      values: [2147483647],
      packed_values: [8191, -8191, 8192, -8192],
      label: "path\\\\slash",
      data: b"\xde\xad\xbe\xef",
      nested: Some((123456789L, false, "note")),
      status: 0U,
      tags: ["a"],
    },
    {
      b64: "CH8QABAAEAAiC3N5bWJvbHMtIUAjMhII////////////ARABGgNuZWc4AUICbTFCAm0yQgJtM0ICbTQ=",
      id: 127,
      values: [0, 0, 0],
      packed_values: [],
      label: "symbols-!@#",
      data: b"",
      nested: Some((-1L, true, "neg")),
      status: 1U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "CIABEAEQAhADGgOAiQ8iCndpdGggc3BhY2UqAgECMgcIARABGgFuOAJCA2R1cEIDZHVw",
      id: 128,
      values: [1, 2, 3],
      packed_values: [123456],
      label: "with space",
      data: b"\x01\x02",
      nested: Some((1L, true, "n")),
      status: 2U,
      tags: ["dup", "dup"],
    },
    {
      b64: "CIAIEIAIEIAQGgEAIgVkZWx0YSoEAP8QIDIAQgF4QgF5",
      id: 1024,
      values: [1024, 2048],
      packed_values: [0],
      label: "delta",
      data: b"\x00\xff\x10\x20",
      nested: Some((0L, false, "")),
      status: 0U,
      tags: ["x", "y"],
    },
    {
      b64: "CID4/////////wEQgICAgPj/////ARoD/4gPIgVnYW1tYSoQAAECAwQFBgcICQoLDA0ODw==",
      id: -1024,
      values: [-2147483648],
      packed_values: [-123456],
      label: "gamma",
      data: b"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f",
      nested: None,
      status: 0U,
      tags: [],
    },
    {
      b64: "CICAARoCAgEiBGJldGEqCKurq6urq6urMhAIgICAgICAgICAARoDbWluOAFCBGVkZ2U=",
      id: 16384,
      values: [],
      packed_values: [1, -1],
      label: "beta",
      data: b"\xab\xab\xab\xab\xab\xab\xab\xab",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 1U,
      tags: ["edge"],
    },
    {
      b64: "CICA/////////wEQ////////////ARD+//////////8BGgr/////D/7///8PIgVhbHBoYSoBADIRCP//////////fxABGgNtYXg4AkIHdGFnLW9uZUIHdGFnLXR3b0IJdGFnLXRocmVl",
      id: -16384,
      values: [-1, -2],
      packed_values: [-2147483648, 2147483647],
      label: "alpha",
      data: b"\x00",
      nested: Some((9223372036854775807L, true, "max")),
      status: 2U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "CP////8HEID4/////////wEQgAgaBX59gAF/KgH/MgsIlZrvOhoEbm90ZUIBYQ==",
      id: 2147483647,
      values: [-1024, 1024],
      packed_values: [63, -63, 64, -64],
      label: "",
      data: b"\xff",
      nested: Some((123456789L, false, "note")),
      status: 0U,
      tags: ["a"],
    },
    {
      b64: "CICAgID4/////wEQ6AcQmPj/////////ARoECgwOECILcGF0aFxcc2xhc2gqBQABAgMEMhII////////////ARABGgNuZWdCAm0xQgJtMkICbTNCAm00",
      id: -2147483648,
      values: [1000, -1000],
      packed_values: [5, 6, 7, 8],
      label: "path\\\\slash",
      data: b"\x00\x01\x02\x03\x04",
      nested: Some((-1L, true, "neg")),
      status: 0U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "EAAaCf5//X+AgAH/fyILc3ltYm9scy0hQCMqBN6tvu8yBwgBEAEaAW44AUIDZHVwQgNkdXA=",
      id: 0,
      values: [0],
      packed_values: [8191, -8191, 8192, -8192],
      label: "symbols-!@#",
      data: b"\xde\xad\xbe\xef",
      nested: Some((1L, true, "n")),
      status: 1U,
      tags: ["dup", "dup"],
    },
    {
      b64: "CAEQfxCAARCBASIKd2l0aCBzcGFjZTIAOAJCAXhCAXk=",
      id: 1,
      values: [127, 128, 129],
      packed_values: [],
      label: "with space",
      data: b"",
      nested: Some((0L, false, "")),
      status: 2U,
      tags: ["x", "y"],
    },
    {
      b64: "CP///////////wEQ/////wcaA4CJDyIFZGVsdGEqAgEC",
      id: -1,
      values: [2147483647],
      packed_values: [123456],
      label: "delta",
      data: b"\x01\x02",
      nested: None,
      status: 0U,
      tags: [],
    },
    {
      b64: "CAIQABAAEAAaAQAiBWdhbW1hKgQA/xAgMhAIgICAgICAgICAARoDbWluQgRlZGdl",
      id: 2,
      values: [0, 0, 0],
      packed_values: [0],
      label: "gamma",
      data: b"\x00\xff\x10\x20",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 0U,
      tags: ["edge"],
    },
    {
      b64: "CP7//////////wEQARACEAMaA/+IDyIEYmV0YSoQAAECAwQFBgcICQoLDA0ODzIRCP//////////fxABGgNtYXg4AUIHdGFnLW9uZUIHdGFnLXR3b0IJdGFnLXRocmVl",
      id: -2,
      values: [1, 2, 3],
      packed_values: [-123456],
      label: "beta",
      data: b"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f",
      nested: Some((9223372036854775807L, true, "max")),
      status: 1U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "CH8QgAgQgBAaAgIBIgVhbHBoYSoIq6urq6urq6syCwiVmu86GgRub3RlOAJCAWE=",
      id: 127,
      values: [1024, 2048],
      packed_values: [1, -1],
      label: "alpha",
      data: b"\xab\xab\xab\xab\xab\xab\xab\xab",
      nested: Some((123456789L, false, "note")),
      status: 2U,
      tags: ["a"],
    },
    {
      b64: "CIABEICAgID4/////wEaCv////8P/v///w8qAQAyEgj///////////8BEAEaA25lZ0ICbTFCAm0yQgJtM0ICbTQ=",
      id: 128,
      values: [-2147483648],
      packed_values: [-2147483648, 2147483647],
      label: "",
      data: b"\x00",
      nested: Some((-1L, true, "neg")),
      status: 0U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "CIAIGgV+fYABfyILcGF0aFxcc2xhc2gqAf8yBwgBEAEaAW5CA2R1cEIDZHVw",
      id: 1024,
      values: [],
      packed_values: [63, -63, 64, -64],
      label: "path\\\\slash",
      data: b"\xff",
      nested: Some((1L, true, "n")),
      status: 0U,
      tags: ["dup", "dup"],
    },
    {
      b64: "CID4/////////wEQ////////////ARD+//////////8BGgQKDA4QIgtzeW1ib2xzLSFAIyoFAAECAwQyADgBQgF4QgF5",
      id: -1024,
      values: [-1, -2],
      packed_values: [5, 6, 7, 8],
      label: "symbols-!@#",
      data: b"\x00\x01\x02\x03\x04",
      nested: Some((0L, false, "")),
      status: 1U,
      tags: ["x", "y"],
    },
    {
      b64: "CICAARCA+P////////8BEIAIGgn+f/1/gIAB/38iCndpdGggc3BhY2UqBN6tvu84Ag==",
      id: 16384,
      values: [-1024, 1024],
      packed_values: [8191, -8191, 8192, -8192],
      label: "with space",
      data: b"\xde\xad\xbe\xef",
      nested: None,
      status: 2U,
      tags: [],
    },
    {
      b64: "CICA/////////wEQ6AcQmPj/////////ASIFZGVsdGEyEAiAgICAgICAgIABGgNtaW5CBGVkZ2U=",
      id: -16384,
      values: [1000, -1000],
      packed_values: [],
      label: "delta",
      data: b"",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 0U,
      tags: ["edge"],
    },
    {
      b64: "CP////8HEAAaA4CJDyIFZ2FtbWEqAgECMhEI//////////9/EAEaA21heEIHdGFnLW9uZUIHdGFnLXR3b0IJdGFnLXRocmVl",
      id: 2147483647,
      values: [0],
      packed_values: [123456],
      label: "gamma",
      data: b"\x01\x02",
      nested: Some((9223372036854775807L, true, "max")),
      status: 0U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "CICAgID4/////wEQfxCAARCBARoBACIEYmV0YSoEAP8QIDILCJWa7zoaBG5vdGU4AUIBYQ==",
      id: -2147483648,
      values: [127, 128, 129],
      packed_values: [0],
      label: "beta",
      data: b"\x00\xff\x10\x20",
      nested: Some((123456789L, false, "note")),
      status: 1U,
      tags: ["a"],
    },
    {
      b64: "EP////8HGgP/iA8iBWFscGhhKhAAAQIDBAUGBwgJCgsMDQ4PMhII////////////ARABGgNuZWc4AkICbTFCAm0yQgJtM0ICbTQ=",
      id: 0,
      values: [2147483647],
      packed_values: [-123456],
      label: "alpha",
      data: b"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f",
      nested: Some((-1L, true, "neg")),
      status: 2U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "CAEQABAAEAAaAgIBKgirq6urq6urqzIHCAEQARoBbkIDZHVwQgNkdXA=",
      id: 1,
      values: [0, 0, 0],
      packed_values: [1, -1],
      label: "",
      data: b"\xab\xab\xab\xab\xab\xab\xab\xab",
      nested: Some((1L, true, "n")),
      status: 0U,
      tags: ["dup", "dup"],
    },
    {
      b64: "CP///////////wEQARACEAMaCv////8P/v///w8iC3BhdGhcXHNsYXNoKgEAMgBCAXhCAXk=",
      id: -1,
      values: [1, 2, 3],
      packed_values: [-2147483648, 2147483647],
      label: "path\\\\slash",
      data: b"\x00",
      nested: Some((0L, false, "")),
      status: 0U,
      tags: ["x", "y"],
    },
    {
      b64: "CAIQgAgQgBAaBX59gAF/IgtzeW1ib2xzLSFAIyoB/zgB",
      id: 2,
      values: [1024, 2048],
      packed_values: [63, -63, 64, -64],
      label: "symbols-!@#",
      data: b"\xff",
      nested: None,
      status: 1U,
      tags: [],
    },
    {
      b64: "CP7//////////wEQgICAgPj/////ARoECgwOECIKd2l0aCBzcGFjZSoFAAECAwQyEAiAgICAgICAgIABGgNtaW44AkIEZWRnZQ==",
      id: -2,
      values: [-2147483648],
      packed_values: [5, 6, 7, 8],
      label: "with space",
      data: b"\x00\x01\x02\x03\x04",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 2U,
      tags: ["edge"],
    },
    {
      b64: "CH8aCf5//X+AgAH/fyIFZGVsdGEqBN6tvu8yEQj//////////38QARoDbWF4Qgd0YWctb25lQgd0YWctdHdvQgl0YWctdGhyZWU=",
      id: 127,
      values: [],
      packed_values: [8191, -8191, 8192, -8192],
      label: "delta",
      data: b"\xde\xad\xbe\xef",
      nested: Some((9223372036854775807L, true, "max")),
      status: 0U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "CIABEP///////////wEQ/v//////////ASIFZ2FtbWEyCwiVmu86GgRub3RlQgFh",
      id: 128,
      values: [-1, -2],
      packed_values: [],
      label: "gamma",
      data: b"",
      nested: Some((123456789L, false, "note")),
      status: 0U,
      tags: ["a"],
    },
    {
      b64: "CIAIEID4/////////wEQgAgaA4CJDyIEYmV0YSoCAQIyEgj///////////8BEAEaA25lZzgBQgJtMUICbTJCAm0zQgJtNA==",
      id: 1024,
      values: [-1024, 1024],
      packed_values: [123456],
      label: "beta",
      data: b"\x01\x02",
      nested: Some((-1L, true, "neg")),
      status: 1U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "CID4/////////wEQ6AcQmPj/////////ARoBACIFYWxwaGEqBAD/ECAyBwgBEAEaAW44AkIDZHVwQgNkdXA=",
      id: -1024,
      values: [1000, -1000],
      packed_values: [0],
      label: "alpha",
      data: b"\x00\xff\x10\x20",
      nested: Some((1L, true, "n")),
      status: 2U,
      tags: ["dup", "dup"],
    },
    {
      b64: "CICAARAAGgP/iA8qEAABAgMEBQYHCAkKCwwNDg8yAEIBeEIBeQ==",
      id: 16384,
      values: [0],
      packed_values: [-123456],
      label: "",
      data: b"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f",
      nested: Some((0L, false, "")),
      status: 0U,
      tags: ["x", "y"],
    },
    {
      b64: "CICA/////////wEQfxCAARCBARoCAgEiC3BhdGhcXHNsYXNoKgirq6urq6urqw==",
      id: -16384,
      values: [127, 128, 129],
      packed_values: [1, -1],
      label: "path\\\\slash",
      data: b"\xab\xab\xab\xab\xab\xab\xab\xab",
      nested: None,
      status: 0U,
      tags: [],
    },
    {
      b64: "CP////8HEP////8HGgr/////D/7///8PIgtzeW1ib2xzLSFAIyoBADIQCICAgICAgICAgAEaA21pbjgBQgRlZGdl",
      id: 2147483647,
      values: [2147483647],
      packed_values: [-2147483648, 2147483647],
      label: "symbols-!@#",
      data: b"\x00",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 1U,
      tags: ["edge"],
    },
    {
      b64: "CICAgID4/////wEQABAAEAAaBX59gAF/Igp3aXRoIHNwYWNlKgH/MhEI//////////9/EAEaA21heDgCQgd0YWctb25lQgd0YWctdHdvQgl0YWctdGhyZWU=",
      id: -2147483648,
      values: [0, 0, 0],
      packed_values: [63, -63, 64, -64],
      label: "with space",
      data: b"\xff",
      nested: Some((9223372036854775807L, true, "max")),
      status: 2U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "EAEQAhADGgQKDA4QIgVkZWx0YSoFAAECAwQyCwiVmu86GgRub3RlQgFh",
      id: 0,
      values: [1, 2, 3],
      packed_values: [5, 6, 7, 8],
      label: "delta",
      data: b"\x00\x01\x02\x03\x04",
      nested: Some((123456789L, false, "note")),
      status: 0U,
      tags: ["a"],
    },
    {
      b64: "CAEQgAgQgBAaCf5//X+AgAH/fyIFZ2FtbWEqBN6tvu8yEgj///////////8BEAEaA25lZ0ICbTFCAm0yQgJtM0ICbTQ=",
      id: 1,
      values: [1024, 2048],
      packed_values: [8191, -8191, 8192, -8192],
      label: "gamma",
      data: b"\xde\xad\xbe\xef",
      nested: Some((-1L, true, "neg")),
      status: 0U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "CP///////////wEQgICAgPj/////ASIEYmV0YTIHCAEQARoBbjgBQgNkdXBCA2R1cA==",
      id: -1,
      values: [-2147483648],
      packed_values: [],
      label: "beta",
      data: b"",
      nested: Some((1L, true, "n")),
      status: 1U,
      tags: ["dup", "dup"],
    },
    {
      b64: "CAIaA4CJDyIFYWxwaGEqAgECMgA4AkIBeEIBeQ==",
      id: 2,
      values: [],
      packed_values: [123456],
      label: "alpha",
      data: b"\x01\x02",
      nested: Some((0L, false, "")),
      status: 2U,
      tags: ["x", "y"],
    },
    {
      b64: "CP7//////////wEQ////////////ARD+//////////8BGgEAKgQA/xAg",
      id: -2,
      values: [-1, -2],
      packed_values: [0],
      label: "",
      data: b"\x00\xff\x10\x20",
      nested: None,
      status: 0U,
      tags: [],
    },
    {
      b64: "CH8QgPj/////////ARCACBoD/4gPIgtwYXRoXFxzbGFzaCoQAAECAwQFBgcICQoLDA0ODzIQCICAgICAgICAgAEaA21pbkIEZWRnZQ==",
      id: 127,
      values: [-1024, 1024],
      packed_values: [-123456],
      label: "path\\\\slash",
      data: b"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 0U,
      tags: ["edge"],
    },
    {
      b64: "CIABEOgHEJj4/////////wEaAgIBIgtzeW1ib2xzLSFAIyoIq6urq6urq6syEQj//////////38QARoDbWF4OAFCB3RhZy1vbmVCB3RhZy10d29CCXRhZy10aHJlZQ==",
      id: 128,
      values: [1000, -1000],
      packed_values: [1, -1],
      label: "symbols-!@#",
      data: b"\xab\xab\xab\xab\xab\xab\xab\xab",
      nested: Some((9223372036854775807L, true, "max")),
      status: 1U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "CIAIEAAaCv////8P/v///w8iCndpdGggc3BhY2UqAQAyCwiVmu86GgRub3RlOAJCAWE=",
      id: 1024,
      values: [0],
      packed_values: [-2147483648, 2147483647],
      label: "with space",
      data: b"\x00",
      nested: Some((123456789L, false, "note")),
      status: 2U,
      tags: ["a"],
    },
    {
      b64: "CID4/////////wEQfxCAARCBARoFfn2AAX8iBWRlbHRhKgH/MhII////////////ARABGgNuZWdCAm0xQgJtMkICbTNCAm00",
      id: -1024,
      values: [127, 128, 129],
      packed_values: [63, -63, 64, -64],
      label: "delta",
      data: b"\xff",
      nested: Some((-1L, true, "neg")),
      status: 0U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "CICAARD/////BxoECgwOECIFZ2FtbWEqBQABAgMEMgcIARABGgFuQgNkdXBCA2R1cA==",
      id: 16384,
      values: [2147483647],
      packed_values: [5, 6, 7, 8],
      label: "gamma",
      data: b"\x00\x01\x02\x03\x04",
      nested: Some((1L, true, "n")),
      status: 0U,
      tags: ["dup", "dup"],
    },
    {
      b64: "CICA/////////wEQABAAEAAaCf5//X+AgAH/fyIEYmV0YSoE3q2+7zIAOAFCAXhCAXk=",
      id: -16384,
      values: [0, 0, 0],
      packed_values: [8191, -8191, 8192, -8192],
      label: "beta",
      data: b"\xde\xad\xbe\xef",
      nested: Some((0L, false, "")),
      status: 1U,
      tags: ["x", "y"],
    },
    {
      b64: "CP////8HEAEQAhADIgVhbHBoYTgC",
      id: 2147483647,
      values: [1, 2, 3],
      packed_values: [],
      label: "alpha",
      data: b"",
      nested: None,
      status: 2U,
      tags: [],
    },
    {
      b64: "CICAgID4/////wEQgAgQgBAaA4CJDyoCAQIyEAiAgICAgICAgIABGgNtaW5CBGVkZ2U=",
      id: -2147483648,
      values: [1024, 2048],
      packed_values: [123456],
      label: "",
      data: b"\x01\x02",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 0U,
      tags: ["edge"],
    },
    {
      b64: "EICAgID4/////wEaAQAiC3BhdGhcXHNsYXNoKgQA/xAgMhEI//////////9/EAEaA21heEIHdGFnLW9uZUIHdGFnLXR3b0IJdGFnLXRocmVl",
      id: 0,
      values: [-2147483648],
      packed_values: [0],
      label: "path\\\\slash",
      data: b"\x00\xff\x10\x20",
      nested: Some((9223372036854775807L, true, "max")),
      status: 0U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "CAEaA/+IDyILc3ltYm9scy0hQCMqEAABAgMEBQYHCAkKCwwNDg8yCwiVmu86GgRub3RlOAFCAWE=",
      id: 1,
      values: [],
      packed_values: [-123456],
      label: "symbols-!@#",
      data: b"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f",
      nested: Some((123456789L, false, "note")),
      status: 1U,
      tags: ["a"],
    },
    {
      b64: "CP///////////wEQ////////////ARD+//////////8BGgICASIKd2l0aCBzcGFjZSoIq6urq6urq6syEgj///////////8BEAEaA25lZzgCQgJtMUICbTJCAm0zQgJtNA==",
      id: -1,
      values: [-1, -2],
      packed_values: [1, -1],
      label: "with space",
      data: b"\xab\xab\xab\xab\xab\xab\xab\xab",
      nested: Some((-1L, true, "neg")),
      status: 2U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "CAIQgPj/////////ARCACBoK/////w/+////DyIFZGVsdGEqAQAyBwgBEAEaAW5CA2R1cEIDZHVw",
      id: 2,
      values: [-1024, 1024],
      packed_values: [-2147483648, 2147483647],
      label: "delta",
      data: b"\x00",
      nested: Some((1L, true, "n")),
      status: 0U,
      tags: ["dup", "dup"],
    },
    {
      b64: "CP7//////////wEQ6AcQmPj/////////ARoFfn2AAX8iBWdhbW1hKgH/MgBCAXhCAXk=",
      id: -2,
      values: [1000, -1000],
      packed_values: [63, -63, 64, -64],
      label: "gamma",
      data: b"\xff",
      nested: Some((0L, false, "")),
      status: 0U,
      tags: ["x", "y"],
    },
    {
      b64: "CH8QABoECgwOECIEYmV0YSoFAAECAwQ4AQ==",
      id: 127,
      values: [0],
      packed_values: [5, 6, 7, 8],
      label: "beta",
      data: b"\x00\x01\x02\x03\x04",
      nested: None,
      status: 1U,
      tags: [],
    },
    {
      b64: "CIABEH8QgAEQgQEaCf5//X+AgAH/fyIFYWxwaGEqBN6tvu8yEAiAgICAgICAgIABGgNtaW44AkIEZWRnZQ==",
      id: 128,
      values: [127, 128, 129],
      packed_values: [8191, -8191, 8192, -8192],
      label: "alpha",
      data: b"\xde\xad\xbe\xef",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 2U,
      tags: ["edge"],
    },
    {
      b64: "CIAIEP////8HMhEI//////////9/EAEaA21heEIHdGFnLW9uZUIHdGFnLXR3b0IJdGFnLXRocmVl",
      id: 1024,
      values: [2147483647],
      packed_values: [],
      label: "",
      data: b"",
      nested: Some((9223372036854775807L, true, "max")),
      status: 0U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
    {
      b64: "CID4/////////wEQABAAEAAaA4CJDyILcGF0aFxcc2xhc2gqAgECMgsIlZrvOhoEbm90ZUIBYQ==",
      id: -1024,
      values: [0, 0, 0],
      packed_values: [123456],
      label: "path\\\\slash",
      data: b"\x01\x02",
      nested: Some((123456789L, false, "note")),
      status: 0U,
      tags: ["a"],
    },
    {
      b64: "CICAARABEAIQAxoBACILc3ltYm9scy0hQCMqBAD/ECAyEgj///////////8BEAEaA25lZzgBQgJtMUICbTJCAm0zQgJtNA==",
      id: 16384,
      values: [1, 2, 3],
      packed_values: [0],
      label: "symbols-!@#",
      data: b"\x00\xff\x10\x20",
      nested: Some((-1L, true, "neg")),
      status: 1U,
      tags: ["m1", "m2", "m3", "m4"],
    },
    {
      b64: "CICA/////////wEQgAgQgBAaA/+IDyIKd2l0aCBzcGFjZSoQAAECAwQFBgcICQoLDA0ODzIHCAEQARoBbjgCQgNkdXBCA2R1cA==",
      id: -16384,
      values: [1024, 2048],
      packed_values: [-123456],
      label: "with space",
      data: b"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f",
      nested: Some((1L, true, "n")),
      status: 2U,
      tags: ["dup", "dup"],
    },
    {
      b64: "CP////8HEICAgID4/////wEaAgIBIgVkZWx0YSoIq6urq6urq6syAEIBeEIBeQ==",
      id: 2147483647,
      values: [-2147483648],
      packed_values: [1, -1],
      label: "delta",
      data: b"\xab\xab\xab\xab\xab\xab\xab\xab",
      nested: Some((0L, false, "")),
      status: 0U,
      tags: ["x", "y"],
    },
    {
      b64: "CICAgID4/////wEaCv////8P/v///w8iBWdhbW1hKgEA",
      id: -2147483648,
      values: [],
      packed_values: [-2147483648, 2147483647],
      label: "gamma",
      data: b"\x00",
      nested: None,
      status: 0U,
      tags: [],
    },
    {
      b64: "EP///////////wEQ/v//////////ARoFfn2AAX8iBGJldGEqAf8yEAiAgICAgICAgIABGgNtaW44AUIEZWRnZQ==",
      id: 0,
      values: [-1, -2],
      packed_values: [63, -63, 64, -64],
      label: "beta",
      data: b"\xff",
      nested: Some((-9223372036854775808L, false, "min")),
      status: 1U,
      tags: ["edge"],
    },
    {
      b64: "CAEQgPj/////////ARCACBoECgwOECIFYWxwaGEqBQABAgMEMhEI//////////9/EAEaA21heDgCQgd0YWctb25lQgd0YWctdHdvQgl0YWctdGhyZWU=",
      id: 1,
      values: [-1024, 1024],
      packed_values: [5, 6, 7, 8],
      label: "alpha",
      data: b"\x00\x01\x02\x03\x04",
      nested: Some((9223372036854775807L, true, "max")),
      status: 2U,
      tags: ["tag-one", "tag-two", "tag-three"],
    },
  ]
  for case in cases {
    let decoded = decode_middle(case.b64)
    assert_eq(decoded.id, case.id)
    assert_eq(decoded.values, case.values)
    assert_eq(decoded.packed_values, case.packed_values)
    assert_eq(decoded.label, case.label)
    assert_eq(decoded.data, case.data)
    assert_eq(decoded.nested, case.nested)
    assert_eq(decoded.status, case.status)
    assert_eq(decoded.tags, case.tags)
    assert_eq(encode_middle(case), case.b64)
  }
}
